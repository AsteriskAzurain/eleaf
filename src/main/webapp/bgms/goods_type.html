<section class="py-5">
	<div class="col">
		
		<form class="form-inline">
			<button type="button" class="btn btn-primary mb-2" style="margin-right: 20px" id="btn-add">添加</button>
			<div class="input-group mb-2">
				<input type="text" placeholder="请输入搜索内容" aria-describedby="button-addon2" class="form-control" />
				<div class="input-group-append">
					<button id="btn-search" type="button" class="btn btn-primary">搜索</button>
				</div>
			</div>
		</form>

		<div class="row-lg-6 mb-4">
			<div class="card">
				<div class="card-header">
					<h6 class="text-uppercase mb-0">商品类别管理</h6>
				</div>
				<div class="card-body" style="overflow: scroll;">
					<table class="table table-striped table-hover card-text" style="min-width: 1500px;">
						<thead>
							<tr>
								<th>#</th>
								<th>类别名</th>
								<th>是否启用</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody class="dataview" dataview="gtype">
							<tr class="dv-unit" style="display: none;">
								<th scope="row" class="dv-elem-index">1</th>
								<td class="dv-elem-expose" dv-elem="type_name">类别名</td>
								<td class="dv-elem-map" dv-elem="hiddenFlag">
									<div class="btn-group-toggle" data-toggle="buttons">
										<label class="btn btn-sm btn-puton active" id="ckb-puton">
										<input type="checkbox" checked /> 启用
										</label>
									</div>
								</td>
								<td>
									<div class="inline">
										<button type="button" class="btn btn-sm btn-secondary" id="btn-update">编辑</button>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		
	</div>
</section>
<script type="text/javascript">
	var gtype_resolve = function(dataset) {
		let map_resolve = function(data, jquery) {
			var attr = jquery.attr('dv-elem');
			switch (attr) {
				case 'hiddenFlag':
					if (data[attr] != 0) {
						jquery.find('label#ckb-puton').removeClass('active');
					} else {
						jquery.find('label#ckb-puton').addClass('active');
					}
					break;
			}
		};
		dv_rendering(dataset, $('.dataview[dataview="gtype"]'), map_resolve, $.noop);
	};
</script>
<script type="text/javascript">
	$('button#btn-add').click(function() {
		changeTab('goods_type_add');
		history.pushState({tab: 'goods_type_add'}, null, view.getUrl('bgms', 'bgms') + '?tab=goods_type&action=add');
	});
	$('button#btn-search').click(function() {
		//console.log('TODO search!');
		//let keywords = $(this).parent().siblings(':text').val().trim();
		let keywords = $(this).parent().siblings(':text').val();
		console.log(keywords);
		if (keywords == '') {
			getGTypeList(null, $.noop, gtype_resolve);
			return;
		}
		let params = {keywords: keywords};
		typeSearch(params, $.noop, gtype_resolve);
	});
	$('button#btn-update').click(function() {
		let id = $(this).parents('tr.dv-unit').attr('id');
		changeTab('goods_type_update');
		history.pushState({tab: 'goods_type_update'}, null, view.getUrl('bgms', 'bgms') + `?tab=goods_type&action=update&id=${id}`);
	});
	$('button#btn-delete').click(function() {
		let id = $(this).parents('tr.dv-unit').attr('id');
		//console.log('TODO delete! id: ' + id);
		let params = {id: id};
		if ($(this).hasClass('active')) {
			typeOnsale(params);
		} else {
			typeWithdraw(params);
		}
	});
</script>
<script type="text/javascript">
	$(document).ready(function() {
		getGTypeList(null, $.noop, gtype_resolve);
	});
</script>